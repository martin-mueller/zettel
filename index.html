<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Zettelwirtschaft</title>
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />
  <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
  <script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
  <link rel="stylesheet" href="style.css" />
  <script>
  $(function() {
    $( ".draggable" ).draggable({
      /*Save position to db after dragging*/
       stop: function(event,ui) {
       $.post('ajax.php',
               {id: $(this).attr('id'), pos: ui.position},
               function(data) {
                  console.log(data);
                });
      }
    })
    .resizable({
       stop: function(event,ui) {
        $.post('ajax.php',{id: $(this).attr('id'), size: ui.size});
        }
    });
    $('.draggable').mouseup(function(){
    
      $('textarea',this).focus();
    });
    $('.draggable').dblclick(function(event) {
      console.log(event);
       $('textarea',this).select();
       console.log($('textarea',this));
    });
    $('.draggable').focusout(function() {
        $.post('ajax.php',
               {id: $(this).attr('id'), text: $('textarea',this).val()});
        }
    );
    /*Initialisation*/
    /*Get Notes from database*/
      $.get('ajax.php',
            {action: 'getAll'},
            function(data) {
                if (data!='null'){
                    data = $.parseJSON(data);
                /*Set positions*/
                    $.each(data,function(index,v){
                      if (v.key == 'pos'){
                        pos = v.value.split(',');
                        $('#'+v.id).animate({top:pos[0]+'px',left:pos[1]+'px'},2000);
                      }
                /*Set Size*/      
                      else if  (v.key == 'size'){
                        size = v.value.split(',');
                        $('#'+v.id).animate({width:size[0]+'px',height:size[1]+'px'},3000);
                      }
                /*Set Text*/      
                      else if (v.key == 'text'){
                        $('#'+v.id+'>textarea').val(v.value);
                      }
                     
                    });
                  }
              }
            );
       
    $('#clear').click(function () {
       if (confirm('Wirklich alles l√∂schen?'))
       $.get('ajax.php',
            {action: 'clearAll'},
            function(data) {
              console.log(data);
            }
            );
    });
  });
  </script>
</head>
<body>
  <div id="wrapper">
    <div id="controls">
      <!-- <input type="button" id="clear" value="clear all" /> -->
    </div>
     <div id="drag1" class="draggable ui-widget-content"><textarea></textarea></div>
     <div id="drag2" class="draggable ui-widget-content"><textarea></textarea></div>
     <div id="drag3" class="draggable ui-widget-content"><textarea></textarea></div>
     <div id="drag4" class="draggable ui-widget-content"><textarea></textarea></div>
     <div id="drag5" class="draggable ui-widget-content"><textarea></textarea></div>
     <div id="drag6" class="draggable ui-widget-content"><textarea></textarea></div>
     <div id="drag7" class="draggable ui-widget-content"><textarea></textarea></div>
     <div id="drag8" class="draggable ui-widget-content"><textarea></textarea></div>
     <div id="drag9" class="draggable ui-widget-content"><textarea></textarea></div>
     <div id="drag10" class="draggable ui-widget-content"><textarea></textarea></div>
  </div>
 </body>
</html>